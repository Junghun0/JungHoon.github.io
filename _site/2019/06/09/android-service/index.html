<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Mobile Lover">
    <meta name="keywords"  content="Mobile">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="[Android] Service 란 - Junghoon's Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Service 란?
화면 없이 백그라운드에서 실행되는 프로세스를 의미한다. 화면이 없다는 점을 제외하면 액티비티처럼 하나의 애플리케이션 구성 요소로 동작한다.
서비스도 애플리케이션의 구성 요소이므로 시스템에서 관리한다. 따라서 새로 만든 서비스는 항상 매니페스트 파일에 등록해야 한다. 서비스를 실행 시킬 때는 메인 액티비티에서 startService(...">
    
    <meta property="article:published_time" content="2019-06-09T00:00:00Z">
    
    
    <meta property="article:author" content="JungHoon-Park">
    
    
    <meta property="article:tag" content="Android">
    
    <meta property="article:tag" content="Mobile">
    
    <meta property="article:tag" content="Study">
    
    
    <meta property="og:image" content="http://localhost:4000">
    <meta property="og:url" content="http://localhost:4000/2019/06/09/android-service/">
    <meta property="og:site_name" content="Junghoon's Blog">
    
    <title>[Android] Service 란 - Junghoon's Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2019/06/09/android-service/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Junghoon's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    <li>
                        <a href="/portfolio/">Portfolio</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/home-bg.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg.jpg');
        background: ;
    }

    
    header.intro-header .header-mask{
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0,0,0, 0.3);
    }
    
</style>

<header class="intro-header style-text" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Android" title="Android">Android</a>
                        
                        <a class="tag" href="/archive/?tag=Mobile" title="Mobile">Mobile</a>
                        
                        <a class="tag" href="/archive/?tag=Study" title="Study">Study</a>
                        
                    </div>
                    <h1>[Android] Service 란</h1>
                    
                    <h2 class="subheading"> About Service </h2>
                    <span class="meta">Posted by JungHoon-Park on June 9, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="service-란">Service 란?</h1>
<p>화면 없이 <code class="highlighter-rouge">백그라운드에서 실행되는 프로세스</code>를 의미한다. 화면이 없다는 점을 제외하면 액티비티처럼 하나의 <code class="highlighter-rouge">애플리케이션 구성 요소</code>로 동작한다.<br /><br />
서비스도 애플리케이션의 구성 요소이므로 시스템에서 관리한다. 따라서 새로 만든 서비스는 항상 매니페스트 파일에 등록해야 한다. 서비스를 실행 시킬 때는 메인 액티비티에서 <code class="highlighter-rouge">startService()</code> 메소드를 호출하면 된다.<br /><br />
서비스가 하는 중요한 역할은 단말이 항상 실행되어 있는 상태로 다른 단말과 데이터를 주고받거나 단말의 상태를 모니터링하는 것이다. 따라서 서비스를 한 번 실행해 두면 실행된 상태가 계속 유지되어야 한다. 이를 위해 서비스가 비정상적으로 종료되더라도 시스템이 자동으로 재실행된다.<br /><br />
그런데 서비스가 한 번 실행된 후 종료되지 않고 계속 실행 중인 상태라면 <code class="highlighter-rouge">startService()</code> 메소드를 여러 번 호출하더라도 서비스의 상태에는 변화가 없게된다. 따라서 <code class="highlighter-rouge">startService()</code>는 서비스를 시작하는 목적보다는 <code class="highlighter-rouge">인텐트를 전달하는 목적</code>으로 더 많이 사용된다.<br /><br />
예를 들어, 액티비티에서 서비스 쪽으로 데이터를 전달하고 싶은 경우 인텐트 객체를 만들고 부가 데이터를 넣은 후 <code class="highlighter-rouge">startService() 메소드를 호출</code>하면서 전달하면 된다. 이때 서비스 객체가 메모리에 만들어져 있으면 onCreate() 메소드가 호출되지 않으므로 <code class="highlighter-rouge">onStartCommand() 메소드를 사용해 전달 받은 인텐트를 처리</code>하게 된다.<br /></p>

<h2 id="service-콜백-메서드">Service 콜백 메서드</h2>
<p>서비스를 생성하려면 <code class="highlighter-rouge">Service</code>의 서브클래스를 생성해야 한다. 구현에서는 서비스 수명 주기의 주요 측면ㅇ르 처리하는 콜백 메서드를 몇 가지 재정의해야 하며 서비스에 바인드할 구성 요소에 대한 메커니즘을 제공해야 한다.</p>

<ul>
  <li>
    <p><strong>onStartCommand()</strong>
시스템이 이 메서드를 호출하는 것은 또 다른 구성 요소가 서비스를 시작하도록 요청하는 경우이다. 이때 <code class="highlighter-rouge">startService()</code>를 호출하는 방법을 사용한다. 이 메서드가 실행되면 서비스가 시작되고 백그라운드에서 무기한으로 실행될 수 있다. 이것을 구현하면 서비스의 작업이 완료되었을 때 해당 서비스를 중단하는 것은 개발자 본인의 책임이며, 이때 <code class="highlighter-rouge">stopSelf()</code> 또는 <code class="highlighter-rouge">stopService()</code> 를 호출하면 된다.</p>
  </li>
  <li>
    <p><strong>onBind()</strong>
시스템이 이 메서드를 호출하는 것은 또 다른 구성 요소가 해당 서비스에 바인드되고자 하는 경우이다. 이때 <code class="highlighter-rouge">bindService()</code>를 호출하는 방법을 쓴다. 이 메서드를 구현할 때에는 클라이언트가 서비스와 통신을 주고받기 위해 사용할 인터페이스를 제공해야 한다. 이때 <code class="highlighter-rouge">IBinder</code>를 리턴하면 된다. 이 메서드는 항상 구현해야 하지만, 바인딩을 허용하지 않고자 하면 null을 리턴하면 된다.</p>
  </li>
  <li>
    <p><strong>onCreate()</strong>
시스템이 이 메서드를 호출하는 것은 서비스가 처음 생성되어 일회성 설정 절차를 수행하는 경우이다. (<code class="highlighter-rouge">onStartCommand()</code>또는<code class="highlighter-rouge">onBind()</code>호출하기 전). 서비스가 이미 실행 중인 경우, 이 메소드는 호출되지 않는다.</p>
  </li>
  <li>
    <p><strong>onDestroy()</strong>
시스템이 이 메서드를 호출하는 것은 해당 서비스를 더 이상 사용하지 않고 소멸시키는 경우이다. 서비스에서 이를 구현해야 스레드, 리스너, 리시버 등 모든 리소스를 정리할 수 있다. 이는 서비스가 수신하는 마지막 호출이다.</p>
  </li>
</ul>

<h2 id="사용해보기">사용해보기</h2>
<h3 id="service">Service</h3>
<h4 id="onstartcommand-메서드의-리턴-값"><strong>onStartCommand()</strong> 메서드의 리턴 값</h4>
<ul>
  <li><code class="highlighter-rouge">START_NOT_STICKY</code><br />
시스템이 서비스를 <code class="highlighter-rouge">onStartCommand()</code> 리턴 후에 중단시키면 서비스는 재생성하면 안된다. 다만 전달할 인텐트가 있는 경우는 예외이다. 이는 서비스가 불필요하게 실행되는 일을 피할 수 있는 가장 안전한 옵션이며, 애플리케이션이 완료되지 않은 모든 작업을 단순히 재시작할 수 있을 때 좋다.</li>
  <li><code class="highlighter-rouge">START_STICKY</code><br />
시스템이 서비스를 <code class="highlighter-rouge">onStartCommand()</code> 반환 후에 중단시키는 경우, 서비스를 재생성하고 <code class="highlighter-rouge">onStartCommand()</code>를 호출하되 마지막 인텐트를 다시 전달하지는 마세요. 그 대신, 시스템이 <code class="highlighter-rouge">null 인텐트</code>로 <code class="highlighter-rouge">onStartCommand()</code>를 호출합니다. 다만, 서비스를 시작할 보류 인텐트가 있는 경우만은 예외이며, 이 경우 이들 인텐트가 전달됩니다. 이것은 명령을 실행하지는 않지만 무기한으로 실행 중이며 작업을 기다리고 있는 미디어 플레이어(또는 그와 비슷한 서비스)에 적합합니다.</li>
  <li><code class="highlighter-rouge">START_REDELIVER_INTENT</code><br />
시스템이 <code class="highlighter-rouge">onStartCommand()</code> 반환 후에 서비스를 중단시키는 경우, 서비스를 재생성하고 이 서비스에 전달된 마지막 인텐트로 <code class="highlighter-rouge">onStartCommand()</code>를 호출하세요. 모든 보류 <code class="highlighter-rouge">인텐트가 차례로 전달</code>됩니다. 이것은 즉시 재개되어야 하는 작업을 능동적으로 수행 중인 서비스(예를 들어 파일 다운로드 등)에 적합합니다.</li>
</ul>

<h4 id="서비스바인딩">서비스바인딩?</h4>
<p>startService() 메소드 대신 <code class="highlighter-rouge">bindService()</code>메소드를 통해 시작되는 서비스를 서비스 바인딩(<code class="highlighter-rouge">Service Bind</code> or <code class="highlighter-rouge">Bound Service</code>)라고 한다.<br /></p>
<ul>
  <li>이 서비스는 마치 클라이언트-서버 관계처럼 동작한다. 서비스가 서버 역할을 한다.</li>
  <li>액티비티는 서비스에 어떠한 요청을 할 수 있고, 서비스로부터 어떠한 결과를 받을 수 있다.</li>
  <li>프로세스간 통신에도 사용된다.</li>
  <li>서비스 바인딩은 연결된 액티비티가 사라지면 서비스도 소멸된다.(<code class="highlighter-rouge">백그라운드에서 무한히 실행되지 않는다.</code>)</li>
  <li>하나의 서비스에 다수 액티비티를 연결할 수 있다.</li>
  <li>애플리케이션 안의 기능을 외부에 제공하는 경우에 많이 사용된다.<br /><br />
<strong>구현 및 동작</strong> <br /></li>
  <li>서비스 바인딩 객체를 생성하려면 콜백 메소드인 onBind()를 구현해야 한다.</li>
  <li><code class="highlighter-rouge">onBind()</code>는 <code class="highlighter-rouge">IBinder</code>를 반환하는데, 바로 이 객체가 서비스와 클라이언트 사이의 인터페이스 역할을 한다.</li>
  <li>클라이언트가 <code class="highlighter-rouge">bindService()</code>를 호출하면, 클라이언트가 서비스에 연결되면서 <code class="highlighter-rouge">IBinder</code>가 반환되고, 클라이언트가 IBinder를 받으면 이 인터페이스를 통해 주고 받는 것이 가능해진다.</li>
  <li>서비스가 제공하는 다른 메소드 호출가능하다.</li>
  <li>여러 클라이언트가 하나의 서비스에 동시 접속이 가능하다.</li>
  <li>클라이언트가 서비스와의 접속을 끝내려면 <code class="highlighter-rouge">unbindService()</code>를 호출한다.</li>
  <li>서비스에 연결된 클라이언트가 하나도 남아있지 않으면 서비스를 소멸시킨다.<br />
<img width="421" src="https://user-images.githubusercontent.com/30828236/59193024-412d1a00-8bbf-11e9-998d-7c1783dbc2f1.png" />
<strong>서비스 생명주기. 왼쪽 다이어그램은 <code class="highlighter-rouge">startService()</code>로 생성된 경우이고, 오른쪽 다이어그램은 서비스가 <code class="highlighter-rouge">bindService()</code>로 생성된 경우의 수명주기를 나타낸다.</strong><br /><br /></li>
  <li>서비스의 전체 수명 주기는 <code class="highlighter-rouge">onCreate()</code>가 호출된 시점과 <code class="highlighter-rouge">onDestroy()</code>가 반환된 시점 사이에 일어납니다. 액티비티와 마찬가지로 서비스는 <code class="highlighter-rouge">자신의 초기 설정을 onCreate()에서 수행</code>하며, 남은 리소스를 모두 <code class="highlighter-rouge">onDestroy()</code>에서 릴리스합니다. 예를 들어 음악 재생 서비스의 경우 음악이 재생될 스레드를 onCreate()에서 생성하고, 그럼 다음 onDestroy()에서 해당 스레드를 중단할 수 있습니다.
<code class="highlighter-rouge">onCreate()</code> 및 <code class="highlighter-rouge">onDestroy()</code> 메서드는 모든 서비스에 대해 호출됩니다. 이는 서비스가 startService()로 생성되었든 bindService()로 생성되었든 상관없이 적용됩니다.</li>
  <li>서비스의 활성 수명 주기는 <code class="highlighter-rouge">onStartCommand()</code> 또는 <code class="highlighter-rouge">onBind()</code>에 대한 호출로 시작됩니다. 각 메서드에 Intent가 전달되며 이것은 각각 <code class="highlighter-rouge">startService()</code> 또는 <code class="highlighter-rouge">bindService()</code>에 전달된 것입니다.
서비스가 시작되면 수명 주기 전체가 종료되는 것과 동시에 활성 수명 주기도 종료됩니다 (서비스는 onStartCommand()가 반환된 뒤에도 여전히 활성 상태입니다). 서비스가 바인드된 경우, <code class="highlighter-rouge">onUnbind()</code>가 반환되면 활성 수명 주기가 종료됩니다.</li>
</ul>

<h4 id="소스코드">소스코드</h4>
<ul>
  <li>서비스 파일 생성
<img width="437" src="https://user-images.githubusercontent.com/30828236/59186409-bd1e6680-8bad-11e9-9c89-f86c5aeb4c7a.png" />
이후에 Manifest 에 추가됨<br /></li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;service</span>
    <span class="na">android:name=</span><span class="s">".MyService"</span>
    <span class="na">android:enabled=</span><span class="s">"true"</span>
    <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;&lt;/service&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>MainActivity<br />
두개의 버튼으로 서비스 시작과 서비스 중지기능을 추가한다.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartService</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStopService</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">stopService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>MyService
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Thread</span> <span class="n">mThread</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">MyService</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">}</span>

  <span class="c1">//startService() -&gt; onStartCommand 호출됨</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">onStartCommand</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
          <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="s">"My Thread"</span><span class="o">){</span>
              <span class="nd">@Override</span>
              <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                      <span class="k">try</span><span class="o">{</span>
                          <span class="n">mCount</span><span class="o">++;</span>
                          <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
                      <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
                          <span class="k">break</span><span class="o">;</span>
                      <span class="o">}</span>
                      <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"My Service"</span><span class="o">,</span><span class="s">"서비스 동작 중"</span><span class="o">+</span><span class="n">mCount</span><span class="o">);</span>
                  <span class="o">}</span>
              <span class="o">}</span>
          <span class="o">};</span>
          <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">START_STICKY</span><span class="o">;</span>
      <span class="c1">//서비스가 예기치않게 종료되어도 서비스가 자동으로 재시작함</span>
  <span class="o">}</span>

  <span class="c1">//onStopService() -&gt; onDestroy()호출됨</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"My Service"</span><span class="o">,</span><span class="s">"onDestroy() 서비스 중지"</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
          <span class="n">mThread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
          <span class="n">mThread</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
          <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// TODO: Return the communication channel to the service.</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">(</span><span class="s">"Not yet implemented"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h3 id="intent-service">Intent Service</h3>
<ul>
  <li><strong>Intent Service</strong>
<code class="highlighter-rouge">Service</code>의 서브클래스로, Worker Thread를 사용하여 모든 시작 요청을 처리하되 한 번에 하나씩 처리한다. 서비스가 여러 개의 요청을 동시에 처리하지 않아도 되는 경우 Intent Service 를 사용하는 것이 좋다.
    <ul>
      <li>애플리케이션의 기본 스레드와는 별도로, <code class="highlighter-rouge">onStartCommand()</code>에 전달된 모든 인텐트를 실행하는 기본 작업자 스레드를 생성한다.</li>
      <li>한 번에 인텐트를 하나씩 <code class="highlighter-rouge">onHandleIntent()</code> 구현에 전달하는 작업 큐를 생성하므로, 다중 스레딩에 대해 걱정할 필요가 없다.</li>
      <li>시작 요청이 모두 처리된 후 서비스를 중단하므로 <code class="highlighter-rouge">stopSelf()</code>를 호출할 필요가 없다.</li>
      <li><code class="highlighter-rouge">onBind()</code>의 기본 구현을 제공하여 null을 반환하도록 합니다.</li>
      <li><code class="highlighter-rouge">onStartCommand()</code>의 기본 구현을 제공하여, <code class="highlighter-rouge">Intent</code>를 작업 큐로 보내고 그 다음은 <code class="highlighter-rouge">onHandleIntent()</code>구현으로 보낸다.</li>
    </ul>
  </li>
</ul>

<h4 id="소스코드-1">소스코드</h4>
<ul>
  <li>MainActivity <br />
버튼을 하나 추가하여 Intent Service 를 시작시키도록 한다.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartIntentService</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">//내부적으로 순서대로 동작한다. 스스로 자기 자신을 중지시킨다.</span>
  <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyIntentService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>MyIntentService <br />
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyIntentService</span> <span class="kd">extends</span> <span class="n">IntentService</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">MyIntentService</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">(</span><span class="s">"MyIntentService"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onHandleIntent</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
          <span class="k">try</span><span class="o">{</span>
              <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
          <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">){</span>
              <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
          <span class="o">}</span>
          <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"My Intent Service"</span><span class="o">,</span><span class="s">"인텐트 서비스 동작 중"</span><span class="o">+</span><span class="n">i</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h3 id="foreground-service">Foreground Service</h3>

<p>항상 서비스가 전면에 올라와있다. 서비스가 백그라운드에서 계속 동작할 때 서비스가 다른 앱에서 메모리를 더필요로 하거나 하는 상황이 오면 안드로이드 시스템에 의해 종료가 될 가능성이 있다.<br /> 지속적으로 강제종료되지 않는 안전한 서비스를 사용하기 위해서는 포그라운드 서비스를 사용해야한다. 하지만 <code class="highlighter-rouge">Foreground Service</code>를 남용하게 되면 안되기 때문에 몇가지 제약을 지켜야한다.<br /> <code class="highlighter-rouge">Notification</code> 함께 제공해야한다.(사용자가 이 것은 포그라운드 서비스로 동작하고 있음을 인지할 수 있도록) 알림 id 를 0이 아닌값을 주어야한다. startForeground 메서드를 서비스 내부에서 별도로 실행해서 foreground로 변경시켜주어야 한다.</p>

<h4 id="startforegroundservice-사용해보기">startForegroundService 사용해보기</h4>
<p><strong>서비스 클래스</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="s">"MyService_Sample3"</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Thread</span> <span class="n">mThread</span><span class="o">;</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kd">public</span> <span class="nf">MyService_Sample3</span><span class="o">()</span> <span class="o">{</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">onStartCommand</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">)</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">(</span><span class="s">"startForeground"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">())){</span>
    <span class="n">startForegroundService</span><span class="o">();</span>
<span class="o">}</span><span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="s">"My Thread"</span><span class="o">){</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">mCount</span><span class="o">++;</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="s">"서비스 동작 중 "</span><span class="o">+</span><span class="n">mCount</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">START_STICKY</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
<span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
<span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="s">"onDestroy!"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">mThread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="n">mThread</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">(</span><span class="s">"Not yet implemented"</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">startForegroundService</span><span class="o">(){</span>
<span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"default"</span><span class="o">);</span><span class="c1">//오레오 부터 channelId가 반드시 필요하다.</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">mipmap</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">);</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">"포그라운드 서비스"</span><span class="o">);</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="s">"포그라운 서비스 실행중"</span><span class="o">);</span>

<span class="n">Intent</span> <span class="n">notificationIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">notificationIntent</span><span class="o">,</span> <span class="mi">0</span> <span class="o">);</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span> <span class="o">{</span><span class="c1">//오레오 이상부터 이 코드가 동작한다.</span>
    <span class="n">NotificationManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">NOTIFICATION_SERVICE</span><span class="o">);</span>
    <span class="n">manager</span><span class="o">.</span><span class="na">createNotificationChannel</span><span class="o">(</span><span class="k">new</span> <span class="n">NotificationChannel</span><span class="o">(</span><span class="s">"default"</span><span class="o">,</span> <span class="s">"기본 채널"</span><span class="o">,</span> <span class="n">NotificationManager</span><span class="o">.</span><span class="na">IMPORTANCE_DEFAULT</span><span class="o">));</span>
<span class="o">}</span>
<span class="n">startForeground</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span><span class="c1">//id를 0으로 하면안된다.</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>MainActivity</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_sample3</span><span class="o">);</span>

        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>


        <span class="n">Button</span> <span class="n">startForegroundService</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">start_foreground</span><span class="o">);</span>
        <span class="n">startForegroundService</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"startForeground"</span><span class="o">);</span>
            <span class="c1">//오레오 이상부터 동작하는 코드</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">startForegroundService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">MainActivity</code>에서 <code class="highlighter-rouge">startForegroundService(intent);</code>를 실행한 후에 서비스 클래스에서 <code class="highlighter-rouge">startForeground</code>를 5초 이내에 실행하지 않으면 <code class="highlighter-rouge">ANR</code>이 발생할 수 있다.<br /></p>

<h3 id="bind-service">Bind Service</h3>
<p><code class="highlighter-rouge">BindService</code>는 <code class="highlighter-rouge">startService()</code>를 통해 시작되는 <code class="highlighter-rouge">UnBound Service</code>와는 다르게 액티비티 및 프래그먼트와 데이터를 주고 받을 수 있으며 프로세스간의 통신에도 사용된다.<br />
서비스를 실행시켜두고 필요할 때마다 서비스의 메소드에 접근하여 통신을 할 수 있는 구조이다.</p>

<p><strong>서비스 클래스</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="n">IBinder</span> <span class="n">mBinder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyBinder</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBinder</span> <span class="kd">extends</span> <span class="n">Binder</span><span class="o">{</span>
        <span class="kd">public</span> <span class="n">MyService_Sample3</span> <span class="nf">getService</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">this</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">MyService_Sample3</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">onStartCommand</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="s">"startForeground"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">())){</span>
            <span class="n">startForegroundService</span><span class="o">();</span>
        <span class="o">}</span><span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">mThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="s">"My Thread"</span><span class="o">){</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="k">try</span> <span class="o">{</span>
                            <span class="n">mCount</span><span class="o">++;</span>
                            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
                        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="s">"서비스 동작 중 "</span><span class="o">+</span><span class="n">mCount</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">};</span>
            <span class="n">mThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">START_STICKY</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span><span class="s">"onDestroy!"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mThread</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">mThread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
            <span class="n">mThread</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="n">mCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IBinder</span> <span class="nf">onBind</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBinder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">mCount</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>MainActivity</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sample3Activity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
    <span class="c1">//액티비티에서 바인드할 서비스의 레퍼런스를 저장할 변수</span>
    <span class="kd">private</span> <span class="n">MyService_Sample3</span> <span class="n">mService</span><span class="o">;</span>
    <span class="c1">//bound 상태를 저장할 변수</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mBound</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_sample3</span><span class="o">);</span>

        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>


        <span class="n">Button</span> <span class="n">startForegroundService</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">start_foreground</span><span class="o">);</span>
        <span class="n">startForegroundService</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">"startForeground"</span><span class="o">);</span>
            <span class="c1">//오레오 이상부터 동작하는 코드</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">O</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">startForegroundService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">startService</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">bindService</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">mConnection</span><span class="o">,</span> <span class="n">BIND_AUTO_CREATE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mBound</span><span class="o">){</span>
            <span class="n">unbindService</span><span class="o">(</span><span class="n">mConnection</span><span class="o">);</span>
            <span class="n">mBound</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">ServiceConnection</span> <span class="n">mConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceConnection</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceConnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">,</span> <span class="n">IBinder</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">MyBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="o">(</span><span class="n">MyService_Sample3</span><span class="o">.</span><span class="na">MyBinder</span><span class="o">)</span> <span class="n">service</span><span class="o">;</span>
            <span class="n">mService</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">getService</span><span class="o">();</span>
            <span class="n">mBound</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onServiceDisconnected</span><span class="o">(</span><span class="n">ComponentName</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 예기치 않은 종료</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><code class="highlighter-rouge">mSerivce</code> 를 사용해 <code class="highlighter-rouge">ServiceClass</code> 에 있는 <code class="highlighter-rouge">getCount()</code>를 통해 <code class="highlighter-rouge">onStartCommand()</code>에서 동작하고 있는 <code class="highlighter-rouge">mCount 값을 MainActivity에서 사용</code>할 수 있다.</p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/06/08/android-fragment/" data-toggle="tooltip" data-placement="top" title="[Android] Fragment 란">
                        Previous<br>
                        <span>[Android] Fragment 란</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/06/11/android-handler/" data-toggle="tooltip" data-placement="top" title="[Android] Handler 사용해보기">
                        Next<br>
                        <span>[Android] Handler 사용해보기</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0012" 
                    href="/archive/?tag=Swift4"
                    title="Swift4"
                    rel="7">Swift4</a>
        
                <a data-sort="0000" 
                    href="/archive/?tag=Study"
                    title="Study"
                    rel="19">Study</a>
        
                <a data-sort="0001" 
                    href="/archive/?tag=Mobile"
                    title="Mobile"
                    rel="18">Mobile</a>
        
                <a data-sort="0008" 
                    href="/archive/?tag=Android"
                    title="Android"
                    rel="11">Android</a>
        
                <a data-sort="0012" 
                    href="/archive/?tag=iOS"
                    title="iOS"
                    rel="7">iOS</a>
        
                <a data-sort="0017" 
                    href="/archive/?tag=Architecture"
                    title="Architecture"
                    rel="2">Architecture
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="https://dydtjr1128.github.io">dydtjr1128</a></li>
  
  <li><a href="https://seongmun-hong.github.io/">SeongMun-Hong</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "junghoon-github-io";
    var disqus_identifier = "/2019/06/09/android-service";
    var disqus_url = "http://localhost:4000/2019/06/09/android-service/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: ''
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/Junghun0">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    All Contents Copyright &copy; Junghoon's Blog 2019
                    <br>
                    Powered by <a href="http://Junghun0.github.io">JungHoon's Blog</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=Junghun0&repo=Junghun0.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-140397414-1';
    var _gaDomain = '';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
